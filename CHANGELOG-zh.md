## v1.6.0 – 更名与双语界面 (2025年12月19日)

### 功能 1：插件更名与新 ID
- **总结**：插件正式更名为 **Hover Annotations**，插件 ID 调整为 `hover-annotations`。
- **痛点**：旧名称/ID 与定位不符，命令前缀不一致影响辨识度。
- **功能细节**：Manifest、包名、README 全面同步新品牌，命令前缀与新 ID 对齐。
- **技术实现**：更新 `manifest.json`、包元数据，并基于 manifest ID 动态重命名命令。

### 功能 2：双语界面与命令
- **总结**：新增英文/简体中文双语支持，可在设置中切换语言。
- **痛点**：英文用户之前会看到中文命令、提示和菜单文案。
- **功能细节**：设置页、提示、右键菜单、命令名称可即时切换语言；默认英文。
- **技术实现**：集中式 `STRINGS` 词条表，新增 `language` 设置，并动态刷新命令名称。

### 功能 3：批注弹窗体验优化
- **总结**：优化新增/编辑批注弹窗的可读性与键盘友好度。
- **痛点**：键盘提示与颜色选中状态不明显，按钮与颜色选择区域分散。
- **功能细节**：新增标题+快捷键提示、颜色选择与按钮同列排列，选中状态与标签更清晰。
- **技术实现**：重构弹窗结构，新增弹性布局样式（如 `annotation-header-row`、`annotation-color-row` 等）。

## v1.5.0 – 全新设置面板与个性化定制 (2025年12月11日)

### 功能 1：全新外观设置面板
- **总结**: 引入了完整的插件设置页面，支持高度自定义外观。
- **解决痛点**: 只有默认样式，无法满足不同主题或个人喜好（如不想看下划线）。
- **功能细节**: 支持开关下划线、背景色、文末图标；支持调整浅色/深色模式下的背景不透明度。
- **技术实现**: 
  - 新增 `AnnotationSettingTab` 类。
  - 使用 CSS 变量 (`--ob-annotation-bg-opacity-light` 等) 动态控制样式。

### 功能 2：极简图标模式 (Icon Mode)
- **总结**: 支持仅显示文末图标 (📌) 而隐藏文本高亮。
- **解决痛点**: 高亮大段文字可能影响阅读体验，用户只想知道哪里有批注。
- **功能细节**: 开启“仅图标模式”后，文本无样式，仅文末显示图标。支持“悬浮”或“点击”触发查看批注。
- **技术实现**: 
  - CSS 新增 `body.ob-show-icon` 和 `::after` 伪元素样式。
  - JS 新增 `isEventOnIcon` 碰撞检测逻辑，精准响应图标交互。

### 功能 3：Tooltip 阅读体验优化
- **总结**: 支持自定义弹窗的宽度和字体大小。
- **解决痛点**: 大段批注在小屏幕上显示不全，或字体太小难以阅读。
- **功能细节**: 设置中新增“Tooltip 最大宽度”和“字体缩放比例”选项。
- **技术实现**: 动态更新 `--ob-annotation-tooltip-width` 和 font-scale 变量。

### 功能 4：数据维护与导出
- **总结**: 新增“导出所有批注”和“一键修复数据”工具。
- **解决痛点**: 难以汇总当前文档的所有批注；旧版本数据格式可能不兼容。
- **功能细节**: 设置页底部新增两个工具按钮：复制当前文档所有批注到剪贴板；修复旧格式数据。
- **技术实现**: 正则表达式提取所有 `<span>` 标签内容并格式化输出。

## v1.4.0 – 批量修复保护与 Markdown 表格支持 (2025年12月10日)

### 功能 1：批量修复保护
- **总结**: 执行“修复所有 Markdown 文件”命令时新增确认弹窗。
- **解决痛点**: 防止用户在不清楚影响范围的情况下误操作。
- **功能细节**: 扫描库文件后弹出确认框，显示受影响文件数量（已移除冗长的文件列表预览，保持界面简洁）。
- **技术实现**: 新增 `BatchFixConfirmModal` 类。

### 功能 2：Tooltip 支持 Markdown 与表格
- **总结**: 悬浮批注现在支持完整的 Markdown 渲染，包括**表格**。
- **解决痛点**: 之前的纯文本显示无法阅读复杂内容（如表格数据），且长文本排版混乱。
- **功能细节**: 
  - 支持粗体、斜体、链接、代码块及**表格**渲染。
  - 针对 Tooltip 内的表格进行了专门的样式优化（边框、间距、背景色），确保美观易读。
  - **[新增] 嵌套表格支持**: 修复了在表格单元格内添加包含表格的批注时渲染失败的问题（通过自动转义竖线 `|` 实现）。
- **技术实现**: 使用 `MarkdownRenderer.render` 替代 `innerText`，并配合 `decodeDataNote` 修复 HTML 实体及竖线冲突问题；CSS 中添加表格特定样式。

### 功能 3：UI 与交互细节优化
- **总结**: 针对图标、边框和主题适配进行了多项微调。
- **功能细节**:
  - **右键菜单图标**: 尺寸放大至 3 倍 (48x48)，并修正了垂直居中对齐问题，视觉更清晰。
  - **Tooltip 样式**: 调整内边距为 `8px 10px`，更加紧凑；修复了被遮挡的问题。
  - **编辑弹窗**: 宽度缩小至 640px (更精致)，且输入框高度会随内容自动伸缩，不再出现滚动条。
  - **主题适配**: 优化了深色/浅色模式下的高亮透明度。
  - **Bug 修复**: 修复了批注编辑弹窗无法显示输入框的问题。

## v1.3.0 – 色彩革命与交互焕新 (2025年12月10日)

### 功能 1：全新色彩系统与可视化交互
- **总结**: 将批注颜色扩展至 8 种，并引入了全新的可视化颜色选择器和右键菜单彩色图标。
- **解决痛点**: 旧版仅有下拉菜单选择颜色，交互繁琐且颜色单一；无法直观感知颜色选项。
- **功能细节**:
  - 新增颜色：红、橙(默认)、黄、绿、青、蓝、紫、灰。
  - 编辑弹窗：使用圆形色块替代下拉菜单，支持 Tab 键聚焦和回车选择，自动记忆上次使用的颜色。
  - 右键菜单：二级菜单中显示真实的彩色圆点图标，直观预览。
  - 新增命令：为每种颜色注册了独立命令（如“添加批注 (红色)”），方便绑定快捷键。
- **技术实现**:
  - `main.ts`: 引入 SVG 动态注册机制 `addIcon`。
  - `styles.css`: 重写 `.annotation-color-item` 样式，支持 hover/active/focus 状态。

### 功能 2：原生级 UI 与移动端适配
- **总结**: 全面重构了悬浮展示框（Tooltip）和编辑弹窗的样式，使其与 Obsidian 原生风格无缝融合，并支持移动端操作。
- **解决痛点**: 旧版黑色 Tooltip 风格突兀；弹窗宽度在长文本下受限；移动端无法查看批注。
- **功能细节**:
  - Tooltip：采用 Obsidian 原生 CSS 变量（`--background-secondary` 等），支持深浅主题自适应；增加上浮动画；宽度放宽至 800px；字体调大。
  - 编辑弹窗：输入框采用 Obsidian 原生表单样式，字体增大。
  - 移动端：支持点击批注显示 Tooltip。
  - 一键开关：新增“显示/隐藏批注样式”命令，可一键切换纯净阅读模式。
- **技术实现**:
  - `styles.css`: 大量使用 `var(--...)` 替换硬编码颜色；添加 `transition` 动画。
  - `main.ts`: 增加 `click` 事件监听器；实现 `toggle-annotation-visibility` 命令。

### 功能 3：右键菜单重构
- **总结**: 优化了右键菜单的结构、顺序和视觉反馈。
- **解决痛点**: 菜单项缺乏层级，功能入口分散。
- **功能细节**:
  - 菜单顺序调整为：添加 -> 编辑 -> 修改颜色 -> 删除。
  - 所有菜单项均配备图标（highlighter, pencil, palette, trash）。
  - 使用分隔线将插件功能与其他菜单项区分。
- **技术实现**:
  - `main.ts`: 使用 `menu.addSeparator()` 和 `setIcon`。

### 修复与优化
- **默认颜色修正**: 修复了默认颜色错误地显示为红色而非橙色的问题。
- **构建同步**: 修复了构建产物中图标尺寸过大 (100x100 -> 16x16) 的问题。
- **撤销体验**: 优化了 `normalizeCurrentFileAnnotations` 命令，保留用户的撤销历史 (Undo History)。
- **依赖安全**: 修正了锁文件中的 registry 源，确保依赖安装的兼容性。

## v1.2.0 — 多行批注与交互升级 (2025-12-09)

### 功能 1：多行批注与安全存储
- **总结**: 支持跨行批注，并安全存储/读取批注内容。
- **解决痛点**: 之前跨行批注会失效，且批注内容中的特殊字符可能破坏 HTML。
- **功能细节**: 多行选区插入的批注在悬浮、右键编辑/删除、Live Preview 中都能正常识别与隐藏，批注文本的换行与符号被完整保留。
- **技术实现**: 
  - COMMENT_REGEX 改为跨行匹配 `[\s\S]*?`，通过 `posToOffset/offsetToPos` 全文定位批注范围。
  - 新增 `escapeDataNote`/`decodeDataNote`，对 `data-note` 进行 `&`, `<`, `>`, 引号、反引号与换行的双向转义，编辑时解码后再保存。
  - Live Preview 装饰使用解码后的批注文本，确保 hover 与右键展示正确内容。

### 功能 2：批注弹窗与提示交互优化
- **总结**: 改进批注弹窗的提交/换行体验，并让悬浮气泡在交互后自动消失。
- **解决痛点**: 之前 Enter 只能换行且气泡会在点击/键盘操作时遮挡文本。
- **功能细节**: Enter 直接提交批注，Shift+Enter 换行；鼠标点击或键盘任意按键后气泡自动隐藏。
- **技术实现**: 
  - Modal 的 keydown 逻辑调整：Enter 提交，Shift+Enter 保留换行。
  - Tooltip 监听 `mousedown`/`keydown` 事件调用 `hideTooltip`, 配合原有移出事件。

## v1.1.0 — 首个公开版 (2025-11-20)

### 功能 1：批注插入与右键编辑/删除
- **总结**: 提供命令和右键菜单快速添加、编辑、删除批注。
- **解决痛点**: 需要在编辑器中便捷标注文字并随时修改或移除。
- **功能细节**: 选中文本通过命令插入 `<span class="ob-comment" data-note="...">`；光标位于批注时右键可编辑或删除，直接替换原内容。
- **技术实现**: 
  - `addCommand` 注册 `add-annotation-html`，`handleContextMenu` 结合 `findAnnotationAtCursor` 定位批注并 `replaceRange` 更新。
  - `AnnotationModal` 采集批注文本，写入 `data-note`，保持原文文本不变。

### 功能 2：悬浮展示与实时预览隐藏 HTML
- **总结**: 悬浮显示批注内容，编辑模式隐藏冗长的 HTML 标签。
- **解决痛点**: HTML 标签干扰写作/阅读体验。
- **功能细节**: Hover 批注文本弹出气泡，阅读模式和实时预览均可查看；编辑模式自动隐藏 `<span>` 标签，仅突出标注文本。
- **技术实现**: 
  - 注册全局 `mouseover`/`mouseout` 显示和关闭 tooltip。
  - CodeMirror `ViewPlugin` 使用 `Decoration.replace/mark` 隐藏标签、标记内容，避开光标所在批注。
