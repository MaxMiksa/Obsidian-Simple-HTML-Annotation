## v1.3.0 – 色彩革命与交互焕新 (2025年12月10日)

### 功能 1：全新色彩系统与可视化交互
- **总结**: 将批注颜色扩展至 8 种，并引入了全新的可视化颜色选择器和右键菜单彩色图标。
- **解决痛点**: 旧版仅有下拉菜单选择颜色，交互繁琐且颜色单一；无法直观感知颜色选项。
- **功能细节**:
  - 新增颜色：红、橙(默认)、黄、绿、青、蓝、紫、灰。
  - 编辑弹窗：使用圆形色块替代下拉菜单，支持 Tab 键聚焦和回车选择，自动记忆上次使用的颜色。
  - 右键菜单：二级菜单中显示真实的彩色圆点图标，直观预览。
  - 新增命令：为每种颜色注册了独立命令（如“添加批注 (红色)”），方便绑定快捷键。
- **技术实现**:
  - `main.ts`: 引入 SVG 动态注册机制 `addIcon`。
  - `styles.css`: 重写 `.annotation-color-item` 样式，支持 hover/active/focus 状态。

### 功能 2：原生级 UI 与移动端适配
- **总结**: 全面重构了悬浮展示框（Tooltip）和编辑弹窗的样式，使其与 Obsidian 原生风格无缝融合，并支持移动端操作。
- **解决痛点**: 旧版黑色 Tooltip 风格突兀；弹窗宽度在长文本下受限；移动端无法查看批注。
- **功能细节**:
  - Tooltip：采用 Obsidian 原生 CSS 变量（`--background-secondary` 等），支持深浅主题自适应；增加上浮动画；宽度放宽至 800px；字体调大。
  - 编辑弹窗：输入框采用 Obsidian 原生表单样式，字体增大。
  - 移动端：支持点击批注显示 Tooltip。
  - 一键开关：新增“显示/隐藏批注样式”命令，可一键切换纯净阅读模式。
- **技术实现**:
  - `styles.css`: 大量使用 `var(--...)` 替换硬编码颜色；添加 `transition` 动画。
  - `main.ts`: 增加 `click` 事件监听器；实现 `toggle-annotation-visibility` 命令。

### 功能 3：右键菜单重构
- **总结**: 优化了右键菜单的结构、顺序和视觉反馈。
- **解决痛点**: 菜单项缺乏层级，功能入口分散。
- **功能细节**:
  - 菜单顺序调整为：添加 -> 编辑 -> 修改颜色 -> 删除。
  - 所有菜单项均配备图标（highlighter, pencil, palette, trash）。
  - 使用分隔线将插件功能与其他菜单项区分。
- **技术实现**:
  - `main.ts`: 使用 `menu.addSeparator()` 和 `setIcon`。

### 修复与优化
- **默认颜色修正**: 修复了默认颜色错误地显示为红色而非橙色的问题。
- **构建同步**: 修复了构建产物中图标尺寸过大 (100x100 -> 16x16) 的问题。
- **撤销体验**: 优化了 `normalizeCurrentFileAnnotations` 命令，保留用户的撤销历史 (Undo History)。
- **依赖安全**: 修正了锁文件中的 registry 源，确保依赖安装的兼容性。

## v1.2.0 — 多行批注与交互升级 (2025-12-09)

### 功能 1：多行批注与安全存储
- **总结**: 支持跨行批注，并安全存储/读取批注内容。
- **解决痛点**: 之前跨行批注会失效，且批注内容中的特殊字符可能破坏 HTML。
- **功能细节**: 多行选区插入的批注在悬浮、右键编辑/删除、Live Preview 中都能正常识别与隐藏，批注文本的换行与符号被完整保留。
- **技术实现**: 
  - COMMENT_REGEX 改为跨行匹配 `[\s\S]*?`，通过 `posToOffset/offsetToPos` 全文定位批注范围。
  - 新增 `escapeDataNote`/`decodeDataNote`，对 `data-note` 进行 `&`, `<`, `>`, 引号、反引号与换行的双向转义，编辑时解码后再保存。
  - Live Preview 装饰使用解码后的批注文本，确保 hover 与右键展示正确内容。

### 功能 2：批注弹窗与提示交互优化
- **总结**: 改进批注弹窗的提交/换行体验，并让悬浮气泡在交互后自动消失。
- **解决痛点**: 之前 Enter 只能换行且气泡会在点击/键盘操作时遮挡文本。
- **功能细节**: Enter 直接提交批注，Shift+Enter 换行；鼠标点击或键盘任意按键后气泡自动隐藏。
- **技术实现**: 
  - Modal 的 keydown 逻辑调整：Enter 提交，Shift+Enter 保留换行。
  - Tooltip 监听 `mousedown`/`keydown` 事件调用 `hideTooltip`，配合原有移出事件。

## v1.1.0 — 首个公开版 (2025-11-20)

### 功能 1：批注插入与右键编辑/删除
- **总结**: 提供命令和右键菜单快速添加、编辑、删除批注。
- **解决痛点**: 需要在编辑器中便捷标注文字并随时修改或移除。
- **功能细节**: 选中文本通过命令插入 `<span class="ob-comment" data-note="...">`；光标位于批注时右键可编辑或删除，直接替换原内容。
- **技术实现**: 
  - `addCommand` 注册 `add-annotation-html`，`handleContextMenu` 结合 `findAnnotationAtCursor` 定位批注并 `replaceRange` 更新。
  - `AnnotationModal` 采集批注文本，写入 `data-note`，保持原文文本不变。

### 功能 2：悬浮展示与实时预览隐藏 HTML
- **总结**: 悬浮显示批注内容，编辑模式隐藏冗长的 HTML 标签。
- **解决痛点**: HTML 标签干扰写作/阅读体验。
- **功能细节**: Hover 批注文本弹出气泡，阅读模式和实时预览均可查看；编辑模式自动隐藏 `<span>` 标签，仅突出标注文本。
- **技术实现**: 
  - 注册全局 `mouseover`/`mouseout` 显示和关闭 tooltip。
  - CodeMirror `ViewPlugin` 使用 `Decoration.replace/mark` 隐藏标签、标记内容，避开光标所在批注。