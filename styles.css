/* ==========================================================================
   1. æ‰¹æ³¨é«˜äº®æ ·å¼ (Annotation Highlights)
   ========================================================================== */

/* å®šä¹‰å…¨å±€å˜é‡ (Defaults, will be overridden by JS) */
:root {
    --ob-annotation-bg-opacity-light: 0.2;
    --ob-annotation-bg-opacity-dark: 0.25;
    --ob-annotation-tooltip-width: 400px;
    --ob-annotation-tooltip-font-scale: 1.0;
}

/* é»˜è®¤æ ·å¼ (æ— è¾¹æ¡†ï¼Œæ— èƒŒæ™¯ï¼Œä»…å®šä¹‰åŸºç¡€å±æ€§) */
.ob-comment {
    --highlight-color: #ff9900;
    
    /* é»˜è®¤ä½¿ç”¨ CSS å˜é‡ï¼Œä½†åœ¨ JS ä¸­ä¼šåŠ¨æ€æ›´æ–°è¿™äº›å˜é‡ */
    --highlight-bg-alpha: var(--ob-annotation-bg-opacity-light); 
    --highlight-bg-hover-alpha: calc(var(--highlight-bg-alpha) + 0.2);
    
    cursor: help;
    transition: background-color 0.2s;
    border-radius: 3px;
    padding: 0 2px;
}

/* æµ…è‰²æ¨¡å¼ä¼˜åŒ– */
.theme-light .ob-comment { 
    --highlight-bg-alpha: var(--ob-annotation-bg-opacity-light);
}

/* æ·±è‰²æ¨¡å¼ä¼˜åŒ– */
.theme-dark .ob-comment { 
    --highlight-bg-alpha: var(--ob-annotation-bg-opacity-dark);
}

/* --- æ˜¾ç¤ºæ¨¡å¼æ§åˆ¶ (Display Modes) --- */

/* 1. ä¸‹åˆ’çº¿æ¨¡å¼ */
body.ob-show-underline .ob-comment {
    border-bottom: 2px solid var(--highlight-color) !important;
}

/* 2. èƒŒæ™¯é«˜äº®æ¨¡å¼ */
body.ob-show-background .ob-comment {
    background-color: rgba(255, 153, 0, var(--highlight-bg-alpha)) !important;
}
body.ob-show-background .ob-comment:hover {
    background-color: rgba(255, 153, 0, var(--highlight-bg-hover-alpha)) !important;
}

/* 3. å›¾æ ‡æ¨¡å¼ (ä¼ªå…ƒç´ ) */
body.ob-show-icon .ob-comment::after {
    content: "ğŸ“";
    font-size: 0.85em;
    margin-left: 4px;
    opacity: 0.8;
    width: 1.05em;
    height: 1.05em;
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    pointer-events: auto;
    cursor: pointer;
}

body.ob-icon-only-mode .ob-comment {
    cursor: text;
}

body.ob-icon-only-mode .ob-comment::after {
    cursor: pointer;
}

/* --- é¢œè‰²å˜ä½“ (Color Variants) --- */
/* 
   ä¸ºäº†æ”¯æŒå åŠ æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿é¢œè‰²å˜ä½“ä¹Ÿèƒ½æ­£ç¡®åº”ç”¨ !importantï¼Œ
   æˆ–è€…é€šè¿‡ CSS å˜é‡æ¥æ§åˆ¶é¢œè‰²ï¼Œä¸Šé¢çš„é€šç”¨è§„åˆ™å·²ç»ä½¿ç”¨äº†å˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦æ›´æ–°å˜é‡å³å¯ã€‚
   ä½†æ˜¯ï¼Œæ—§çš„é¢œè‰²ç±»ç›´æ¥è®¾ç½®äº† background-colorã€‚æˆ‘ä»¬éœ€è¦è°ƒæ•´ç­–ç•¥ã€‚
   
   æœ€ä½³ç­–ç•¥ï¼šè®©é¢œè‰²ç±»åªå®šä¹‰ CSS å˜é‡ --highlight-colorã€‚
   èƒŒæ™¯è‰²ç”±ä¸Šé¢çš„é€šç”¨è§„åˆ™ç»Ÿä¸€å¤„ç†ã€‚
*/

.ob-comment.red { --highlight-color: #e5484d; }
.ob-comment.yellow { --highlight-color: #e6c229; }
.ob-comment.green { --highlight-color: #2f9d62; }
.ob-comment.cyan { --highlight-color: #1abc9c; }
.ob-comment.blue { --highlight-color: #3498db; }
.ob-comment.purple { --highlight-color: #9b59b6; }
.ob-comment.gray { --highlight-color: #95a5a6; }

/* 
   ç”±äºé¢œè‰²å˜ä½“åŸæœ¬ä¹Ÿè®¾ç½®äº† background-colorï¼Œæˆ‘ä»¬éœ€è¦è¦†ç›–å®ƒï¼Œ
   æˆ–è€…è®©å®ƒä¹Ÿéµå¾ª body.ob-show-background çš„é€»è¾‘ã€‚
   ç°åœ¨çš„é€šç”¨è§„åˆ™ body.ob-show-background .ob-comment ä½¿ç”¨äº† !importantï¼Œ
   å®ƒä¼šè¦†ç›–é¢œè‰²ç±»ä¸­ï¼ˆå¦‚æœæœ‰ï¼‰çš„æ™®é€š background-color å£°æ˜ã€‚
   ä½†æ˜¯ï¼Œä¸Šé¢çš„ .ob-comment.red ç­‰ç±»ç›®å‰åªå®šä¹‰äº†å˜é‡ï¼ˆåœ¨æˆ‘ä¿®æ”¹åï¼‰ã€‚
   ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿é¢œè‰²ç±»ä¹Ÿé’ˆå¯¹ä¸åŒæ¨¡å¼æœ‰æ­£ç¡®çš„è¡¨ç°ã€‚
   
   å…¶å®ï¼Œåªè¦ .ob-comment åŠå…¶é¢œè‰²å˜ä½“åªå®šä¹‰å˜é‡ï¼Œ
   ç„¶åç”± body.ob-show-background .ob-comment ç»Ÿä¸€ä½¿ç”¨è¿™äº›å˜é‡è®¾ç½® background-colorï¼Œ
   é€»è¾‘å°±å®Œç¾äº†ã€‚
   
   æˆ‘ä»¬éœ€è¦ä¿®æ­£é¢œè‰²å˜ä½“çš„å®šä¹‰ï¼Œå»æ‰å…¶ä¸­çš„ background-color å’Œ border-bottom å±æ€§ï¼Œ
   æ”¹ä¸ºåªå®šä¹‰å˜é‡ã€‚
*/

/* ç§»é™¤æ—§çš„ç‰¹å®šé¢œè‰²èƒŒæ™¯å®šä¹‰ï¼Œå®ƒä»¬å°†ç”±é€šç”¨è§„åˆ™æ¥ç®¡ */
.ob-comment.red, .ob-comment.yellow, .ob-comment.green, 
.ob-comment.cyan, .ob-comment.blue, .ob-comment.purple, .ob-comment.gray {
    /* No direct styles, just variable updates above */
}

/* å¤„ç† Hover çŠ¶æ€çš„é¢œè‰²å˜é‡æ›´æ–° */
.ob-comment.red { background-color: transparent; } /* Reset */
body.ob-show-background .ob-comment.red { background-color: rgba(229, 72, 77, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.red:hover { background-color: rgba(229, 72, 77, var(--highlight-bg-hover-alpha)) !important; }

body.ob-show-background .ob-comment.yellow { background-color: rgba(230, 194, 41, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.yellow:hover { background-color: rgba(230, 194, 41, var(--highlight-bg-hover-alpha)) !important; }

body.ob-show-background .ob-comment.green { background-color: rgba(47, 157, 98, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.green:hover { background-color: rgba(47, 157, 98, var(--highlight-bg-hover-alpha)) !important; }

body.ob-show-background .ob-comment.cyan { background-color: rgba(26, 188, 156, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.cyan:hover { background-color: rgba(26, 188, 156, var(--highlight-bg-hover-alpha)) !important; }

body.ob-show-background .ob-comment.blue { background-color: rgba(52, 152, 219, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.blue:hover { background-color: rgba(52, 152, 219, var(--highlight-bg-hover-alpha)) !important; }

body.ob-show-background .ob-comment.purple { background-color: rgba(155, 89, 182, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.purple:hover { background-color: rgba(155, 89, 182, var(--highlight-bg-hover-alpha)) !important; }

body.ob-show-background .ob-comment.gray { background-color: rgba(149, 165, 166, var(--highlight-bg-alpha)) !important; }
body.ob-show-background .ob-comment.gray:hover { background-color: rgba(149, 165, 166, var(--highlight-bg-hover-alpha)) !important; }



/* ==========================================================================
   2. æ‚¬æµ®å¼¹çª—æ ·å¼ (Tooltip) - Native Look
   ========================================================================== */
body .ob-annotation-tooltip {
    position: absolute;
    /* ä½¿ç”¨ Obsidian åŸç”Ÿå˜é‡ */
    background-color: var(--background-secondary); 
    color: var(--text-normal);
    /* æ•´åˆåŸæœ‰è¾¹æ¡†é€»è¾‘ */
    border: 1px solid var(--modifier-border);
    box-shadow: var(--shadow-l);
    
    padding: 8px 10px;
    border-radius: 6px;
    
    /* Ensure markdown content (like tables) wraps and displays correctly */
    white-space: normal;
    
    /* å­—ä½“å¤§å°ï¼šåŠ¨æ€ç¼©æ”¾ */
    font-size: calc(var(--font-ui-medium) * var(--ob-annotation-tooltip-font-scale));
    line-height: 1.4;
    
    /* å®½åº¦ï¼šåŠ¨æ€è®¾ç½® */
    max-width: min(var(--ob-annotation-tooltip-width), 90vw);
    white-space: normal; /* Ensure text wraps */
    
    z-index: var(--layer-popover);
    pointer-events: none;
    
    opacity: 0;
    /* åˆå§‹çŠ¶æ€å‘ä¸‹åç§» 8pxï¼Œæ˜¾ç¤ºæ—¶ä¸Šæµ®åˆ° 0 */
    transform: translateY(8px);
    /* å¢åŠ  transition åŠ¨æ•ˆï¼Œä½¿ç”¨ cubic-bezier å¢åŠ ä¸€ç‚¹å¼¹æ€§æ„Ÿ */
    transition: opacity 0.2s ease-out, transform 0.25s cubic-bezier(0.18, 0.89, 0.32, 1.28);
}

body .ob-annotation-tooltip.is-visible {
    opacity: 1;
    transform: translateY(0);
}

/* Reset margins for Markdown rendered content inside tooltip */
body .ob-annotation-tooltip p {
    margin: 0;
}


/* ==========================================================================
   7. è¡¨æ ¼æ ·å¼æ”¯æŒ (Table Support in Tooltip)
   ========================================================================== */
body .ob-annotation-tooltip table {
    border-collapse: collapse;
    border-spacing: 0;
    margin: 8px 0;
    width: max-content;
    max-width: 100%;
}

body .ob-annotation-tooltip th,
body .ob-annotation-tooltip td {
    padding: 4px 10px;
    border: 1px solid var(--background-modifier-border);
}

body .ob-annotation-tooltip th {
    background-color: var(--background-secondary);
    font-weight: 600;
}

body .ob-annotation-tooltip tr:nth-child(even) {
    background-color: var(--background-primary-alt);
}


/* ==========================================================================
   3. æ¨¡æ€æ¡†é¢œè‰²é€‰æ‹©å™¨ (Color Picker UI)
   ========================================================================== */
.annotation-color-container {
    display: flex;
    gap: 12px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    align-items: center;
    padding: 4px 2px;
}

.annotation-color-item {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent; 
    transition: all 0.15s ease-in-out;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: relative;
    box-sizing: border-box;
}

/* é”®ç›˜èšç„¦çŠ¶æ€ */
.annotation-color-item:focus-visible {
    outline: 2px solid var(--interactive-accent);
    outline-offset: 2px;
}

.annotation-color-item:hover {
    transform: scale(1.15);
}

/* é€‰ä¸­çŠ¶æ€ */
.annotation-color-item.is-active {
    border-color: var(--background-primary);
    outline: 2px solid var(--interactive-accent);
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.theme-dark .annotation-color-item {
    box-shadow: 0 2px 4px rgba(0,0,0,0.4);
}

/* ==========================================================================
   4. Live Preview è¾…åŠ©
   ========================================================================== */
.cm-ob-comment-tag-hide {
    display: none;
}

/* ==========================================================================
   5. å¼¹çª— UI å¢å¼º (Modal UI Enhancements)
   ========================================================================== */

/* 1. æ”¾å®½å¼¹çª—å®½åº¦ (Adjusted per user request: 80% of previous size) */
.ob-annotation-modal-container {
    width: 640px !important; 
    max-width: 80vw !important;
}

.annotation-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 8px;
}

.annotation-header-row h2 {
    margin: 0;
}

.annotation-color-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
}

/* 2. è¾“å…¥æ¡†ç¾åŒ– */
.annotation-input {
    background-color: var(--background-modifier-form-field);
    border: 1px solid var(--background-modifier-border);
    color: var(--text-normal);
    border-radius: var(--input-radius);
    padding: 10px;
    font-family: var(--font-text);
    /* å­—ä½“è°ƒå¤§ */
    font-size: var(--font-ui-medium); 
    line-height: 1.5;
    transition: all 0.2s ease;
    resize: none; /* Disable manual resize since we use auto-resize */
    overflow-y: hidden; /* Hide scrollbar for auto-resize */
}

.annotation-input:focus {
    border-color: var(--interactive-accent);
    box-shadow: 0 0 0 2px var(--background-modifier-border-focus);
    outline: none;
}

.annotation-key-hint {
    margin: 0;
    color: var(--text-muted);
    font-size: 0.9em;
    text-align: right;
}

.modal-button-container {
    margin-top: 20px;
}

.modal-button-container.inline {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 0;
}

/* ==========================================================================
   6. ä¸€é”®å¼€å…³ (Toggle Visibility)
   ========================================================================== */
/* å½“ body æ‹¥æœ‰æ­¤ class æ—¶ï¼Œéšè—æ‰¹æ³¨çš„è§†è§‰æ ·å¼ */
body.ob-hide-annotations .ob-comment {
    border-bottom: none !important;
    background-color: transparent !important;
}

/* åŒæ—¶éšè— Tooltip */
body.ob-hide-annotations .ob-annotation-tooltip {
    display: none !important;
}
